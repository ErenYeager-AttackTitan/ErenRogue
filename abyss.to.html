<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hydrax Upload</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6 flex items-center justify-center">
  <div class="max-w-xl w-full bg-white p-6 rounded-xl shadow-lg space-y-4">
    <h2 class="text-2xl font-bold text-center text-gray-800">Hydrax Uploader</h2>

    <!-- Video Upload -->
    <div>
      <label class="block font-medium text-gray-700 mb-2">Select Video File</label>
      <input type="file" id="videoFile" accept="video/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700">
    </div>

    <!-- Subtitle Info -->
    <div>
      <label class="block text-gray-700 mb-1">Subtitle URL</label>
      <input type="text" id="subtitleUrl" class="w-full px-3 py-2 border rounded-md" placeholder="https://example.com/subtitle.srt">
    </div>
    <div>
      <label class="block text-gray-700 mb-1">Subtitle Label</label>
      <input type="text" id="subtitleLabel" class="w-full px-3 py-2 border rounded-md" placeholder="English">
    </div>

    <!-- Upload Button -->
    <button id="uploadBtn" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg font-semibold">
      Upload Video & Subtitle
    </button>

    <!-- Response Box -->
    <div id="response" class="text-sm text-gray-800 mt-4 space-y-2"></div>
  </div>

  <script>
    $("#uploadBtn").on("click", function () {
      const file = $("#videoFile")[0].files[0];
      const subtitleUrl = $("#subtitleUrl").val();
      const subtitleLabel = $("#subtitleLabel").val();

      if (!file) return alert("Please select a video file.");
      if (!subtitleUrl || !subtitleLabel) return alert("Please fill subtitle URL and label.");

      $("#response").html("<div class='text-blue-600'>Uploading video...</div>");

      const formData = new FormData();
      formData.append("file", file);

      // Step 1: Upload video
      $.ajax({
        url: "http://up.hydrax.net/5ad53759ada34ea357b1ef70883ceb84",
        method: "POST",
        data: formData,
        processData: false,
        contentType: false,
        success: function (videoRes) {
          if (videoRes.status && videoRes.slug) {
            const slug = videoRes.slug;
            $("#response").append(`<div class='text-green-600'>Video uploaded! Slug: <code>${slug}</code></div>`);
            $("#response").append("<div class='text-blue-600'>Uploading subtitle...</div>");

            // Step 2: Upload subtitle
            $.ajax({
              url: `https://api.hydrax.net/5ad53759ada34ea357b1ef70883ceb84/subtitle/${slug}`,
              method: "POST",
              contentType: "application/json",
              data: JSON.stringify({
                url: subtitleUrl,
                label: subtitleLabel
              }),
              success: function () {
                $("#response").append("<div class='text-green-600'>Subtitle uploaded successfully!</div>");
              },
              error: function () {
                $("#response").append("<div class='text-red-600'>Subtitle upload failed.</div>");
              }
            });
          } else {
            $("#response").html("<div class='text-red-600'>Video upload failed. No slug returned.</div>");
          }
        },
        error: function () {
          $("#response").html("<div class='text-red-600'>Video upload request failed. Check CORS or server status.</div>");
        }
      });
    });
  </script>
</body>
</html>
