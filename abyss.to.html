<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hydrax Uploader</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-md space-y-4">
    <h2 class="text-2xl font-bold text-center text-gray-800">Hydrax Video & Subtitle Uploader</h2>

    <!-- Video Upload -->
    <div>
      <label class="block font-medium text-gray-700 mb-2">Select Video File</label>
      <input type="file" id="videoFile" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-500 file:text-white hover:file:bg-blue-700">
    </div>

    <!-- Subtitle Info -->
    <div>
      <label class="block text-gray-700 mb-1">Subtitle URL</label>
      <input type="text" id="subtitleUrl" class="w-full px-3 py-2 border rounded-md" placeholder="https://example.com/sub.srt">
    </div>
    <div>
      <label class="block text-gray-700 mb-1">Subtitle Label</label>
      <input type="text" id="subtitleLabel" class="w-full px-3 py-2 border rounded-md" placeholder="English">
    </div>

    <!-- Upload Button -->
    <button id="uploadBtn" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg font-semibold">
      Upload Video & Subtitle
    </button>

    <div id="response" class="text-sm text-gray-800 mt-4"></div>
  </div>

  <script>
    $("#uploadBtn").on("click", async function () {
      const fileInput = document.getElementById("videoFile");
      const file = fileInput.files[0];
      const subtitleUrl = $("#subtitleUrl").val();
      const subtitleLabel = $("#subtitleLabel").val();

      if (!file) return alert("Please select a video file.");

      // Step 1: Upload video
      const formData = new FormData();
      formData.append("file", file);

      $("#response").text("Uploading video...");

      try {
        const videoUploadRes = await fetch("http://up.hydrax.net/5ad53759ada34ea357b1ef70883ceb84", {
          method: "POST",
          body: formData
        });

        const uploadData = await videoUploadRes.json();

        if (!uploadData.status) throw new Error("Video upload failed");

        const slug = uploadData.slug;
        $("#response").text("Video uploaded. Uploading subtitle...");

        // Step 2: Upload subtitle
        $.ajax({
          url: `https://api.hydrax.net/5ad53759ada34ea357b1ef70883ceb84/subtitle/${slug}`,
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify({
            url: subtitleUrl,
            label: subtitleLabel
          }),
          success: function (data) {
            $("#response").html(`<div class="text-green-600 font-medium">Upload successful! Slug: <code>${slug}</code></div>`);
          },
          error: function (err) {
            $("#response").html(`<div class="text-red-600">Subtitle upload failed.</div>`);
          }
        });

      } catch (error) {
        $("#response").html(`<div class="text-red-600">Video upload failed: ${error.message}</div>`);
      }
    });
  </script>
</body>
</html>
